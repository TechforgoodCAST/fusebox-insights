
<h1><%= @project.title %></h1>
 
<p><%= @project.description %></p>
<%= link_to 'Edit', edit_project_path(@project), class: "btn btn-primary" %>
<%= link_to 'Destroy', project_path(@project),
              method: :delete,
              data: { confirm: 'Are you sure?' },
              class: "btn btn-primary"%>

<h2>Roadmap</h2>
<%= link_to 'Add iteration', new_project_iteration_path(@project), class: "btn btn-primary" %>
<%= link_to 'Add milestone', new_project_milestone_path(@project), class: "btn btn-primary" %>

<style>
  #roadmap{
    border-left: 4px solid #000;
  }
  
  .milestone::before{
    content:"";
    height: 20px;
    width: 20px;
    border: 2px solid #000;
    transform: rotate(45deg);
    margin-right: 10px;
    margin-left: 3px;
    background: #fff;
  }
  
</style>
<div id="roadmap">
  <%
  merged = [];

  #Get iterations
  @project.iterations.each do |iteration| 
    merged << {
      :type => 'iteration',
      :date => iteration.start_date,
      :data => iteration
    }
  end
   
  #Get milestones
  @project.milestones.each do |milestone| 
    merged << {
      :type => 'milestone',
      :date => milestone.date,
      :data => milestone
    }
  end

  #Sort the merged array reverse chronologically
  items = merged.sort_by { |hsh| hsh[:date] }.reverse
  
  items.each do |item| 
    
    if item[:type] == 'iteration' 
      iteration = item[:data]
  %>
      <div class='row iteration'>
        <div class='card mb-4'>
          <div class="card-body">
            <h4 class="pt-1 mb-1"><%= link_to iteration.title, [@project, iteration] %></h4>
            <p class="pt-1 mb-1"><%= iteration.start_date.strftime("%e %b %Y") %> - <%= iteration.end_date.strftime("%e %b %Y") %></p>
          </div>
        </div>
      </div>
    <% 
    else 
      milestone = item[:data]
    %>
      <div class='row milestone'>
        <p><strong><%= link_to milestone.title, [@project, milestone] %>:</strong> <%= milestone.description%></p>
      </div>
    <% end %>
  <% end %>
</div>